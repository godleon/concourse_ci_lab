# resource_types:
# - name: slack-notification
#   type: docker-image
#   source:
#     repository: cfcommunity/slack-notification-resource
#     tag: latest


# resources:
# - name: osp_test_resource
#   type: git
#   source:
#     uri: https://github.com/godleon/concourse_ci_lab
#     branch: master

- name: resource-version
  type: semver
  source:
    driver: git
    initial_version: 0.0.1
    uri: git@github.com:godleon/osp_test_results.git
    branch: version
    file: version
    private_key: {{ github-private-key }}

# - name: slack-alert
#   type: slack-notification
#   source:
#     url: https://hooks.slack.com/services/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


jobs:
- name: job-versioning
  public: true
  serial: true
  plan:
  - get: resource-version
  - task: display-version
    config:
      platform: linux
      image_resource:
        type: docker-image
        source: {repository: busybox}
      inputs:
      - name: resource-version
      run:
        path: cat
        args: [resource-version/number]
# - name: tempest-test
#   public: true
#   plan:
#   - get: osp_test_resource
#     param: { BUILD_ID: $BUILD_ID }
#     trigger: true
#   - task: tempest
#     file: osp_test_resource/07.slack_notification/build_tasks/tempest_test.yml
  # - put: tempest_output
  # - task: debug_task
  #   file: osp_test_resource/07.slack_notification/build_tasks/debug_task.yml

# - name: slack-notify
#   public: true
#   plan:
#   - get: tempest-test
#     passed: [tempest-test]
#     # trigger: true
#   - put: slack-alert
#     params:
#       channel: '#ci_message'
#       icon_emoji: ':robot_face:'
#       text_file: tempest_output/slack_message.txt
#       text: |
#         The build had a result. Check it out at:
#         http://10.5.17.254:8080/teams/$BUILD_TEAM_NAME/pipelines/$BUILD_PIPELINE_NAME/jobs/$BUILD_JOB_NAME/builds/$BUILD_NAME
#         or at: 
#         http://10.5.17.254:8080/builds/$BUILD_ID

#         Result: "Slack Result!"
        
#         #$TEXT_FILE_CONTENT

# - name: rally-test
#   public: true
#   plan:
#   - get: osp_test_resource
#     trigger: true
#     passed: [tempest]
#       params:
#       bump: minor
#     rc: true
#   - task: rally
#     file: osp_test_resource/06.osp10_tempest_rally/build_tasks/rally_test.yml