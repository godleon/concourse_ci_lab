platform: linux

image_resource:
  type: docker-image
  source:
    repository: python
    tag: 3.6
    # repository: ubuntu
    # tag: xenial

inputs:
- name: git-osp
- name: git-semver
- name: rally_test

outputs:
- name: rally_test_output

run:
  path: sh
  args:
  - -exc
  - |
    ENTRY_PATH=$(pwd)
    whoami
    env
  
    apt-get update
    apt-get -y install git python3 python3-jinja2

    cd git-osp/09.rally/scripts
    mkdir -p propagate_tests
    git clone https://github.com/openstack/rally.git
    find rally/samples/tasks/scenarios/ -type f -name '*.json' | egrep 'rally/samples/tasks/scenarios/(authenticate|cinder|glance|keystone|neutron|nova|quotas|requests|swift)' > upstream_tests.list

    cat upstream_tests.list

    echo $(pwd) + '/' + rally/samples/tasks/scenarios/authenticate/keystone.json
    cat $(pwd) + '/' + rally/samples/tasks/scenarios/authenticate/keystone.json

    chmod +x propagate_test.py
    ./propagate_test.py

    find .