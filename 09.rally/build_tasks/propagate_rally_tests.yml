platform: linux

image_resource:
  type: docker-image
  source:
    repository: ubuntu
    tag: xenial

inputs:
- name: git-osp
- name: git-semver
- name: rally_test

outputs:
- name: rally_test_output

run:
  path: sh
  args:
  - -exc
  - |
    whoami
    env
  
    apt-get update
    apt-get -y install git python3 python3-jinja2

    git clone https://github.com/openstack/rally.git
    find rally/samples/tasks/scenarios/ -type f -name '*.json' | egrep 'rally/samples/tasks/scenarios/(authenticate|cinder|glance|keystone|neutron|nova|quotas|requests|swift)' > git-osp/09.rally/configs/upstream_tests.list

    find .

    python3 git-osp/09.rally/scripts/propagate_test.py
    find .